<!--just an empty index file 3: -->
<html>
<head>

    <meta charset="utf-8">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<!-- style for pie chart-->
    <style>

        #pieChart {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            width: 960px;
            height: 500px;
            position: relative;
        }

        svg {
            width: 100%;
            height: 100%;
        }

        path.slice{
            stroke-width:2px;
        }

        polyline{
            opacity: .3;
            stroke: black;
            stroke-width: 2px;
            fill: none;
        }

        .labelValue
        {
            font-size: 100%;
            opacity: .5;
            color: white;

        }

        .toolTip {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            position: absolute;
            display: none;
            width: auto;
            height: auto;
            background: none repeat scroll 0 0 white;
            border: 0 none;
            border-radius: 8px 8px 8px 8px;
            box-shadow: -3px 3px 15px #888888;
            color: white;
            font: 12px sans-serif;
            padding: 5px;
            text-align: center;
        }
        .text {
            font: 12px sans-serif;
            color: white;
        }
    </style>


<!--Style for bar chart

    <style type="text/css">

        text {
            font: 10px sans-serif;
        }

        rect.background {
            fill: white;
        }

        .axis {
            shape-rendering: crispEdges;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
        }


    </style>
-->

<!-- style for bootstrp divs and navbar-->
    <style>
        body {
            position: relative;
        }
        #word {padding-top:50px;height:750px;color: #fff; background-color: #35478C;}
        #famous {padding-top:50px;height:750px;color: #fff; background-color: #4E7AC7;}
        #loud {padding-top:50px;height:750px;color: #fff; background-color: #7FB2F0;}
        #topNav {background-color: #16193B;}
    </style>

<!-- style for scatter plot-->

<style>
    body {
        font-family:"Helvetica Neue";
        color: #686765;

    }
    .name {
        float:right;
        color:#27aae1;
    }
    .axis {
        fill: none;
        stroke: #AAA;
        stroke-width: 1px;
    }
    text {
        stroke: none;
        fill: #666666;
        font-size: .6em;
        font-family:"Helvetica Neue"
    }
    .label {
        fill: #414241;
        text-anchor: start;
    }
    .node {
        cursor:pointer;
    }
    .dot {
        opacity: .7;
        cursor: pointer;
    }
</style>

<style>
    .tip {
        font-size: 12px;
        color: white;
        position: absolute;
        pointer-events: none;
    }
</style>

</head>



<!-->
<body>
<!--
<body data-spy="scroll" data-target=".navbar" data-offset="50">
-->

<script src="/socket.io/socket.io.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>



<!--
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-selection-multi.v1.min.js"></script>
-->



<nav class="navbar navbar-inverse navbar-fixed-top" id="topNav">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">SongStats</a>
        </div>
        <div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">
                    <li><a href="#word">Words</a></li>
                    <li><a href="#famous">Famous</a></li>
                    <li><a href="#loud">Loudness</a></li>
                </ul>
            </div>
        </div>
    </div>
</nav>

<div id="word" class="container-fluid">
    <h1>Most Used Words in Songs</h1>
    <div id ="pieChart">
        <input name="dataset" id="dataset" type="range" min="1920" max="2000" value="1920" step="10" onchange="showPieValue(this.value)" />
        <span id="pieRange">1920</span>
    </div>

</div>
<div id="famous" class="container-fluid">
    <h1>Familiarity vs Hottnesss</h1>
    <input name="scatterDataset" id="scatterDataset" type="range" min="1920" max="2000" value="1920" step="10" onchange="showScatterValue(this.value)" />
    <span id="scatterRange">1920</span>
    <div id="scatter-div"></div>
</div>

<div id="loud" class="container-fluid">
    <h1>Loudness of songs</h1>
    <div class="someclass">
        <h2>Create A Bar Chart With D3 JavaScript</h2>
        <div id="bar-chart">

        </div>
    </div>
</div>


<!-- slider updates-->
<script>
    function showPieValue(newValue)
    {
        document.getElementById("pieRange").innerHTML=newValue;
    }
    function showScatterValue(newValue)
    {
        document.getElementById("scatterRange").innerHTML=newValue;
    }
</script>



<!-- code for pie chart-->
<script src="http://d3js.org/d3.v3.min.js"></script>
<!-->
<script>
   // d3.select("input[value=\"total\"]").property("checked", true);

    var svg = d3.select("#pieChart")
            .append("svg")
            .append("g")

    svg.append("g")
            .attr("class", "slices");
    svg.append("g")
            .attr("class", "labelName");
    svg.append("g")
            .attr("class", "labelValue");
    svg.append("g")
            .attr("class", "lines");

    var width = 960,
            height = 450,
            radius = Math.min(width, height) / 2;

    var pie = d3.layout.pie()
            .sort(null)
            .value(function(d) {
                return d.value;
            });

    var arc = d3.svg.arc()
            .outerRadius(radius * 0.8)
            .innerRadius(radius * 0.3);

    var outerArc = d3.svg.arc()
            .innerRadius(radius * 0.7)
            .outerRadius(radius * 0.9);

    var legendRectSize = (radius * 0.05);
    var legendSpacing = radius * 0.02;


    var div = d3.select("#pieChart").append("div").attr("class", "toolTip");

    svg.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

    var colorRange = d3.scale.category20();
    var color = d3.scale.ordinal()
            .range(colorRange.range());


//    datasetTotal = [
//        {label:"Category 1", value:19},
//        {label:"Category 2", value:5},
//        {label:"Category 3", value:13},
//        {label:"Category 4", value:17},
//        {label:"Category 5", value:19},
//        {label:"Category 6", value:27}
//    ];
//
//    datasetOption1 = [
//        {label:"Category 1", value:22},
//        {label:"Category 2", value:33},
//        {label:"Category 3", value:4},
//        {label:"Category 4", value:15},
//        {label:"Category 5", value:36},
//        {label:"Category 6", value:0}
//    ];
//
//    datasetOption2 = [
//        {label:"Category 1", value:10},
//        {label:"Category 2", value:20},
//        {label:"Category 3", value:30},
//        {label:"Category 4", value:5},
//        {label:"Category 5", value:12},
//        {label:"Category 6", value:23}
//    ];



    d3.select("#dataset")
            .on("change", selectDataset);

    function selectDataset()
    {
        var value = this.value;
        sendPieYearQuery(value);
    }

    function change(data) {

        /* ------- PIE SLICES -------*/
        var slice = svg.select(".slices").selectAll("path.slice")
                .data(pie(data), function(d){ return d.data.label });

        slice.enter()
                .insert("path")
                .style("fill", function(d) { return color(d.data.label); })
                .attr("class", "slice");

        slice
                .transition().duration(1000)
                .attrTween("d", function(d) {
                    this._current = this._current || d;
                    var interpolate = d3.interpolate(this._current, d);
                    this._current = interpolate(0);
                    return function(t) {
                        return arc(interpolate(t));
                    };
                })
        slice
                .on("mousemove", function(d){
                    div.style("left", d3.event.pageX+10+"px");
                    div.style("top", d3.event.pageY-25+"px");
                    div.style("display", "inline-block");
                    div.html((d.data.label)+"<br>"+(d.data.value));
                });
        slice
                .on("mouseout", function(d){
                    div.style("display", "none");
                });

        slice.exit()
                .remove();
//LEGEND CODE
//        var legend = svg.selectAll('.legend')
//                .data(color.domain())
//                .enter()
//                .append('g')
//                .attr('class', 'legend')
//                .attr('transform', function(d, i) {
//                    var height = legendRectSize + legendSpacing;
//                    var offset =  height * color.domain().length / 2;
//                    var horz = -3 * legendRectSize;
//                    var vert = i * height - offset;
//                    return 'translate(' + horz + ',' + vert + ')';
//                });
//
//        legend.append('rect')
//                .attr('width', legendRectSize)
//                .attr('height', legendRectSize)
//                .style('fill', color)
//                .style('stroke', color);
//
//        legend.append('text')
//                .attr('x', legendRectSize + legendSpacing)
//                .attr('y', legendRectSize - legendSpacing)
//                .text(function(d) { return d; });

        /* ------- TEXT LABELS -------*/

        var text = svg.select(".labelName").selectAll("text")
                .data(pie(data), function(d){ return d.data.label });

        text.enter()
                .append("text")
                .attr("dy", ".35em")
                .text(function(d) {
                    return (d.data.label+": "+d.value);
                });

        function midAngle(d){
            return d.startAngle + (d.endAngle - d.startAngle)/2;
        }

        text
                .transition().duration(1000)
                .attrTween("transform", function(d) {
                    this._current = this._current || d;
                    var interpolate = d3.interpolate(this._current, d);
                    this._current = interpolate(0);
                    return function(t) {
                        var d2 = interpolate(t);
                        var pos = outerArc.centroid(d2);
                        pos[0] = radius * (midAngle(d2) < Math.PI ? 1 : -1);
                        return "translate("+ pos +")";
                    };
                })
                .styleTween("text-anchor", function(d){
                    this._current = this._current || d;
                    var interpolate = d3.interpolate(this._current, d);
                    this._current = interpolate(0);
                    return function(t) {
                        var d2 = interpolate(t);
                        return midAngle(d2) < Math.PI ? "start":"end";
                    };
                })
                .text(function(d) {
                    return (d.data.label+": "+d.value);
                });


        text.exit()
                .remove();

        /* ------- SLICE TO TEXT POLYLINES -------*/

        var polyline = svg.select(".lines").selectAll("polyline")
                .data(pie(data), function(d){ return d.data.label });

        polyline.enter()
                .append("polyline");

        polyline.transition().duration(1000)
                .attrTween("points", function(d){
                    this._current = this._current || d;
                    var interpolate = d3.interpolate(this._current, d);
                    this._current = interpolate(0);
                    return function(t) {
                        var d2 = interpolate(t);
                        var pos = outerArc.centroid(d2);
                        pos[0] = radius * 0.95 * (midAngle(d2) < Math.PI ? 1 : -1);
                        return [arc.centroid(d2), outerArc.centroid(d2), pos];
                    };
                });

        polyline.exit()
                .remove();
    };

</script>


<!--Scatter plot code -->
<script>



        // size and margins for the chart
        var margin = {
                    top: 20,
                    right: 15,
                    bottom: 60,
                    left: 60
                }, width = 500 - margin.left - margin.right,
                height = 400 - margin.top - margin.bottom;
        var x = d3.scale.linear()
                .domain([0, 1])
                .range([0, width]);
        var y = d3.scale.linear()
                .domain([0, 1])
                .range([height, 0]);


        var tip = d3.select('#scatter-div')
                .append('div')
                .attr('class', 'tip')
                .style("opacity", 0);
        var chart = d3.select('#scatter-div')
                .append('svg')
                .attr('width', width + margin.right + margin.left)
                .attr('height', height + margin.top + margin.bottom)
                .attr('class', 'chart')
        var main = chart.append('g')
                .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')
                .attr('width', width)
                .attr('height', height)
                .attr('class', 'main')
        // draw the x axis
        var xAxis = d3.svg.axis()
                .scale(x)
                .orient('bottom');
        main.append('g')
                .attr('transform', 'translate(0,' + height + ')')
                .attr('class', 'main axis date')
                .call(xAxis)
                .append("text")
                .attr("class", "label")
                .attr('transform', 'translate(180,30)')
                .text("Artist Hottnesss");

        // draw the y axis
        var yAxis = d3.svg.axis()
                .scale(y)
                .orient('left');
        main.append('g')
                .attr('transform', 'translate(0,0)')
                .attr('class', 'main axis date')
                .call(yAxis)
                .append("text")
                .attr("class", "label")
                .attr("transform", "rotate(90) translate(120,30)")
                .text("Artist Familiarity");

        // draw the graph object
        var g = main.append("svg:g");

        d3.select("#scatterDataset")
                .on("change", selectScatterDataset);
        function selectScatterDataset()
        {
            var value = this.value;
            console.log('SCATTER INPUT UPDATING!!!!')
            sendScatterYearQuery(value);
        }

        function scatterCreate(data) {
            var points = g.selectAll("scatter-dots").data(data);
            points.enter().append("svg:circle")
                .attr("cy", function (d) {
                    return y(d.y);
                })
                .attr("cx", function (d, i) {
                    return x(d.x);
                })
                .attr("r", 3)
                .style("opacity", 0.6)
                .on('mouseover', function (d, i) {
                    tip.transition()
                            .duration(200)
                            .style("opacity", .9);
                    tip.html( "Artist: "+d.artist + "<br/>"  + "Song: " + d.song_title );
                    tip.style('border', '2px solid black')
                    tip.style('background-color', 'steelblue')

                    tip.style('top', y(d.y) - 20 + 'px');
                    tip.style('left', x(d.x) + 'px');
                    tip.style('display', 'block');
                })
                .on('mouseout', function (d, i) {
                    tip.transition()
                            .duration(500)
                            .style("opacity", 0);
                });

    }
</script>



<script>
    var socket = io();//init socket.io on client


    socket.on('I am born', function(){
        console.log('INIT client pie chart');
        socket.emit('pie year query request', 1920);
        //socket.emit('bar year query request');
        socket.emit('scatter year query request', 1920);

    });//listen to 'I am born' event, first event upon connection

    socket.on('pie year query response', createPieChart);// listen to an event for a query response after requesting it
    socket.on('bar year query response', createBarChart);// listen to an event for a query response after requesting it
    socket.on('scatter year query response', createScatterChart);// listen to an event for a query response after requesting it


    //sample function to send a query
    function sendPieYearQuery(data) {
        console.log('query sent for pie chart');
        console.log(data);//data contains the message contents
        socket.emit('pie year query request', data);
    }

    //sample function to do stuff with the data after receiving them from the query response
    function createPieChart(data){
        console.log('received pie query response');
        console.log('Creating a graph with: ' + JSON.stringify(data));//data contains the message contents
        var graphData = []
        data.forEach(function (d) {
//            var label = d.key;
//            var value = d.doc_count;
            var obj = {label: d.key, value: d.doc_count}
            graphData.push(obj)
        });
        console.log('graph data:')
        console.log(graphData)
        change(graphData)
    }

    function createBarChart(data) {
        console.log('received bar query response');
        console.log('Creating a bar graph with: ' + JSON.stringify(data));//data contains the message contents
        //call function to create chart
    }


    //sample function to send a query
    function sendScatterYearQuery(data) {
        console.log('query sent for scatter chart');
        console.log(data);//data contains the message contents
        socket.emit('scatter year query request', data);
    }

    //sample function to do stuff with the data after receiving them from the query response
    function createScatterChart(data){
        console.log('received scatter query response');
        //console.log('Creating a graph with: ' + JSON.stringify(data));//data contains the message contents
        var graphData = [];
        data.forEach(function (d) {
//            var label = d.key;
//            var value = d.doc_count;
            var obj = {x:  d.artist_hottnesss, y: d.artist_familiarity, artist: d.artist_name, song_title:d.title}
            graphData.push(obj)
        });
        console.log('scatter graph data:')
        //console.log(graphData)
        scatterCreate(graphData);

    }

</script>




</body>



</html>